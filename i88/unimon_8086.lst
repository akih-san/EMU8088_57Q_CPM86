 AS V1.42 Beta [Bld 227] - Source File unimon_8086.asm - Page 1 - 1/21/2024 17:9:57


       1/       0 :                     	page 0
       2/       0 :                     ;;;
       3/       0 :                     ;;; Universal Monitor 8086
       4/       0 :                     ;;;   Copyright (C) 2020 Haruo Asano
       5/       0 :                     ;;;
       6/       0 :                     
       7/       0 :                     	CPU	8086
       8/       0 :                     
       9/       0 : ="8088"              TARGET:	EQU	"8088"
      10/       0 :                     
      11/       0 : =1H                  CPM86 = 1
      12/       0 :                     
      13/       0 :                     ;;;
      14/       0 :                     ;;; Memory
      15/       0 :                     ;;;
      16/       0 :                     
      17/       0 : =0FF50H              MON_CSEG	equ	0ff50h
      18/       0 : =0FF30H              MON_DSEG	equ	0ff30h
      19/       0 : =40H                 FREE_SEG	equ	0040h
      20/       0 : =2500H               BIOS_IP		equ	2500h		; CP\M-86 BIOS start IP
      21/       0 :                     
      22/       0 : =0H                  MON_B:	EQU	0000h
      23/       0 : =100H                WORK_B:	EQU	0100h
      24/       0 : =100H                STACK:	EQU	WORK_B
      25/       0 :                     
      26/       0 : =50H                 BUFLEN:	EQU	80
      27/       0 : =100H                VECSIZ:	EQU	256		; Number of vectors to be initialized
      28/       0 :                     
      29/       0 : =84H                 int21vec:	equ	21H * 4 ; INT 21H Vector table offset
      30/       0 :                     ;;;
      31/       0 :                     ;;; Options
      32/       0 :                     ;;;
      33/       0 :                     
      34/       0 : =>TRUE               	if CPM86
      35/       0 : =40H                 CPM86_CODE	equ	FREE_SEG
      36/       0 : =2500H               BIOS_ENTRY	equ	2500h
      37/       0 : [34]                 	endif
      38/       0 :                     ;;;
      39/       0 :                     ;;; PIC18F57Qxx
      40/       0 :                     ;;;
      41/       0 :                     
      42/       0 : =0H                  USARTD:	EQU	00H
      43/       0 : =2H                  USARTC:	EQU	02H
      44/       0 :                     
      45/       0 :                     ;;; Constants
      46/       0 : =0DH                 CR:	EQU	0DH
      47/       0 : =0AH                 LF:	EQU	0AH
      48/       0 : =8H                  BS:	EQU	08H
      49/       0 : =7FH                 DEL:	EQU	7FH
      50/       0 :                     
      51/       0 : =10H                 F_bitSize	equ	16
      52/       0 : =0FD5H               f_msk_bit	equ	0000111111010101b
      53/       0 : =0ED5H               Tbit_OFF	equ	0000111011010101b
      54/       0 : =100H                Tbit_ON_	equ	0000000100000000b
      55/       0 :                     
      56/       0 : =30H                 NMI_SIG_OFF	equ	30h	; 30h NMI signal off (LED OFF) port
      57/       0 :                     
      58/       0 :                     	ASSUME	CS:CODE, DS:DATA, SS:DATA, ES:NOTHING
      59/       0 :                     
      60/       0 :                     ;;;
      61/       0 :                     ;;; ROM area
      62/       0 :                     ;;;
      63/       0 :                     
      64/       0 :                     	SEGMENT	CODE
      65/       0 :                     	
      66/       0 :                     	ORG	MON_B
      67/       0 :                     
      68/       0 :                     CSTART:
      69/       0 : B8 30 FF            	MOV	AX,MON_DSEG
      70/       3 : 8E D8               	MOV	DS,AX
      71/       5 : 8E C0               	mov	es,ax
      72/       7 : 8E D0               	MOV	SS,AX
      73/       9 : A3 78 01            	MOV	[REGSS],AX	; set init SS value
      74/       C : B8 00 01            	mov	ax, STACK
      75/       F : 8B E0               	MOV	SP, ax
      76/      11 : A3 6A 01            	MOV	[REGSP],AX	; set init SP value
      77/      14 :                     	
      78/      14 : B0 49               	MOV	AL,'I'
      79/      16 : A2 5C 01            	MOV	[HEXMOD],AL	; Intel Hex mode
      80/      19 : 33 C0               	XOR	AX,AX
      81/      1B : A3 52 01            	MOV	[DSADDR],AX	; set dump start address
      82/      1E : A3 58 01            	MOV	[GADDR],AX	; set Go address to 0000h
      83/      21 : A3 5A 01            	MOV	[SADDR],AX	; Set memory address
      84/      24 :                     
      85/      24 :                     	; init break point
      86/      24 : A2 7C 01            	mov	[bflg], al	; clear break flag
      87/      27 :                     
      88/      27 :                     	;; Initialize register value
      89/      27 : BB 60 01            	MOV	BX,REG_B
      90/      2A : B9 0E 00            	MOV	CX,(REG_E - REG_B)/2
      91/      2D :                     IR0:
      92/      2D : 89 07               	MOV	[BX],AX
      93/      2F : 43                  	INC	BX
      94/      30 : 43                  	INC	BX
      95/      31 : 49                  	DEC	CX
      96/      32 : 75 F9               	JNE	IR0
      97/      34 :                     
      98/      34 : B8 40 00            	mov	ax, FREE_SEG	; set free memory start segment
      99/      37 : A3 50 01            	MOV	[CURSEG],AX	; set current segment
     100/      3A : A3 74 01            	mov	[REGCS], ax
     101/      3D :                     	; init break point segment
     102/      3D : A3 7E 01            	mov	[brkcs], ax
     103/      40 :                     
     104/      40 : B8 00 25            	mov	ax, BIOS_IP
     105/      43 : A3 72 01            	mov	[REGIP], ax	; set start IP:100h
     106/      46 :                     	; init break point ip
     107/      46 : A3 80 01            	mov	[brkip], ax	; clear break point ip
     108/      49 :                     
     109/      49 : B8 40 00            	MOV	AX,FREE_SEG	; set free memory start segment
     110/      4C : A3 76 01            	MOV	[REGDS],AX	; CS=DS=ES=SS
     111/      4F : A3 7A 01            	MOV	[REGES],AX
     112/      52 :                     
     113/      52 :                     	;; Initialize vector
     114/      52 : 33 C0               	XOR	AX,AX
     115/      54 : 8E C0               	MOV	ES,AX
     116/      56 : BE 61 08            	MOV	SI,INIVEC
     117/      59 : 8B F8               	MOV	DI,AX
     118/      5B : B9 00 02            	MOV	CX,VECSIZ*2
     119/      5E :                     INI0:	
     120/      5E : 2E 8B 04            	MOV	AX,CS:[SI]
     121/      61 : 46                  	INC	SI
     122/      62 : 46                  	INC	SI
     123/      63 : 26 89 05            	MOV	ES:[DI],AX
     124/      66 : 47                  	INC	DI
     125/      67 : 47                  	INC	DI
     126/      68 : 49                  	DEC	CX
     127/      69 :                     ;	JZ	INI2
     128/      69 : 81 FE 75 08         	CMP	SI,INIVECE
     129/      6D : 75 EF               	JNZ	INI0
     130/      6F : B8 B6 07            	MOV	AX,INTDMY
     131/      72 : BB 50 FF            	MOV	BX,MON_CSEG
     132/      75 :                     INI1:
     133/      75 : 26 89 05            	MOV	ES:[DI],AX
     134/      78 : 47                  	INC	DI
     135/      79 : 47                  	INC	DI
     136/      7A : 26 89 1D            	MOV	ES:[DI],BX
     137/      7D : 47                  	INC	DI
     138/      7E : 47                  	INC	DI
     139/      7F : 49                  	DEC	CX
     140/      80 : 49                  	DEC	CX
     141/      81 : 75 F2               	JNZ	INI1
     142/      83 :                     ;INI2:
     143/      83 :                     	; init INT 21H
     144/      83 : BF 84 00            	mov	di, int21vec
     145/      86 : B8 B5 06            	mov	ax, INTFNC
     146/      89 : 26 89 05            	mov	es:[di],ax
     147/      8C : 47                  	inc	di
     148/      8D : 47                  	inc	di
     149/      8E : 26 89 1D            	mov	es:[di],bx
     150/      91 :                     	
     151/      91 :                     ; Check CPU TYPE
     152/      91 :                     
     153/      91 : BB 14 08            	mov	bx, IMV20
     154/      94 : B8 00 01            	MOV	AX,0100H
     155/      97 : D5 00               	DB	0D5H,00H	; AAD 00H
     156/      99 : 0A C0               	OR	AL,AL
     157/      9B : 75 03               	JNE	ID_V20		; V20
     158/      9D : BB 0D 08            	mov	bx, IM88	; 8088
     159/      A0 :                     ID_V20:
     160/      A0 : 89 1E 5D 01         	MOV	[PSPEC],BX
     161/      A4 :                     
     162/      A4 : BB 01 08            	mov	bx, cpu_msg
     163/      A7 : E8 05 05            	CALL	MSGOUT
     164/      AA :                     
     165/      AA : 8B 1E 5D 01         	mov	bx, [PSPEC]	; get CPU MSG address
     166/      AE : E8 FE 04            	CALL	MSGOUT
     167/      B1 :                     
     168/      B1 : =>TRUE               	if CPM86
     169/      B1 : BB B7 07            	mov	bx, invoke_msg
     170/      B4 : E8 F8 04            	CALL	MSGOUT
     171/      B7 : EA 00 25 40 00      	jmpf	CPM86_CODE:BIOS_ENTRY
     172/      BC :                     
     173/      BC : =>FALSE              	else
     174/      BC :                     
     175/      BC :                     	;; Universal Moniter Opening message
     176/      BC :                     	MOV	BX,OPNMSG
     177/      BC :                     	CALL	MSGOUT
     178/      BC : [168]                	endif
     179/      BC :                     
     180/      BC :                     WSTART:
     181/      BC : B8 30 FF            	mov	ax, MON_DSEG
     182/      BF : 8E D8               	mov	ds, ax
     183/      C1 : 8E D0               	mov	ss, ax
     184/      C3 : BC 00 01            	mov	sp, STACK
     185/      C6 :                     
     186/      C6 : BB 1A 08            	MOV	BX,PROMPT
     187/      C9 : E8 E3 04            	CALL	MSGOUT
     188/      CC : E8 52 05            	CALL	GETLIN
     189/      CF : BB 00 01            	MOV	BX,INBUF
     190/      D2 : E8 9B 05            	CALL	SKIPSP
     191/      D5 : E8 A2 05            	CALL	UPPER
     192/      D8 : 22 C0               	AND	AL,AL
     193/      DA : 74 E0               	JZ	WSTART
     194/      DC :                     
     195/      DC : 3C 44               	CMP	AL,'D'
     196/      DE : 75 02               	JNE	M00
     197/      E0 : EB 2B               	JMP	DUMP
     198/      E2 :                     M00:	
     199/      E2 : 3C 47               	CMP	AL,'G'
     200/      E4 : 75 03               	JNE	M01
     201/      E6 : E9 41 01            	JMP	GO
     202/      E9 :                     M01:
     203/      E9 : 3C 53               	CMP	AL,'S'
     204/      EB : 75 03               	JNE	M02
     205/      ED : E9 F6 01            	JMP	SETM
     206/      F0 :                     
     207/      F0 :                     M02:	
     208/      F0 : 3C 4C               	CMP	AL,'L'
     209/      F2 : 75 03               	JNE	M03
     210/      F4 : E9 79 02            	JMP	LOADH
     211/      F7 :                     M03:
     212/      F7 :                     
     213/      F7 : 3C 52               	CMP	AL,'R'
     214/      F9 : 75 03               	JNE	M05
     215/      FB : E9 6E 03            	JMP	REG
     216/      FE :                     
     217/      FE :                     M05:
     218/      FE : 3C 54               	CMP	AL,'T'
     219/     100 : 75 03               	JNE	M06
     220/     102 : E9 43 04            	JMP	Trace
     221/     105 :                     
     222/     105 :                     M06:
     223/     105 :                     ERR:
     224/     105 : BB 37 08            	MOV	BX,ERRMSG
     225/     108 : E8 A4 04            	CALL	MSGOUT
     226/     10B : EB AF               	JMP	WSTART
     227/     10D :                     
     228/     10D :                     ;;;
     229/     10D :                     ;;; DUMP memory
     230/     10D :                     ;;;
     231/     10D :                     
     232/     10D :                     DUMP:
     233/     10D : 43                  	INC	BX
     234/     10E : E8 74 05            	CALL	RDHEX
     235/     111 : 0A C9               	OR	CL,CL
     236/     113 : 75 15               	JNZ	DP0
     237/     115 :                     	;; No arg.
     238/     115 : E8 58 05            	CALL	SKIPSP
     239/     118 : 0A C0               	OR	AL,AL
     240/     11A : 75 E9               	JNZ	ERR
     241/     11C :                     
     242/     11C : 8B 16 52 01         	MOV	DX,[DSADDR]
     243/     120 : 81 C2 80 00         	ADD	DX,128
     244/     124 : 89 16 54 01         	MOV	[DEADDR],DX
     245/     128 : EB 40               	JMP	DPM
     246/     12A :                     
     247/     12A :                     	;; 1st arg. found
     248/     12A :                     DP0:
     249/     12A : 8A 07               	MOV	AL,[BX]
     250/     12C : 3C 3A               	CMP	AL,':'
     251/     12E : 75 0C               	JNZ	DP01
     252/     130 : 89 16 50 01         	MOV	[CURSEG],DX
     253/     134 : 43                  	INC	BX
     254/     135 : E8 4D 05            	CALL	RDHEX
     255/     138 : 0A C9               	OR	CL,CL
     256/     13A : 74 C9               	JZ	ERR
     257/     13C :                     DP01:	
     258/     13C : 89 16 52 01         	MOV	[DSADDR],DX
     259/     140 : 8A 07               	MOV	AL,[BX]
     260/     142 : 3C 2C               	CMP	AL,','
     261/     144 : 74 0E               	JZ	DP1
     262/     146 : 0A C0               	OR	AL,AL
     263/     148 : 75 BB               	JNZ	ERR
     264/     14A :                     	;; No 2nd arg.
     265/     14A : 81 C2 80 00         	ADD	DX,128
     266/     14E : 89 16 54 01         	MOV	[DEADDR],DX
     267/     152 : EB 16               	JMP	DPM
     268/     154 :                     DP1:
     269/     154 : 43                  	INC	BX
     270/     155 : E8 2D 05            	CALL	RDHEX
     271/     158 : E8 15 05            	CALL	SKIPSP
     272/     15B : 0A C9               	OR	CL,CL
     273/     15D : 74 A6               	JZ	ERR
     274/     15F : 8A 07               	MOV	AL,[BX]
     275/     161 : 0A C0               	OR	AL,AL
     276/     163 : 75 A0               	JNZ	ERR
     277/     165 : 42                  	INC	DX
     278/     166 : 89 16 54 01         	MOV	[DEADDR],DX
     279/     16A :                     DPM:
     280/     16A :                     	;; DUMP main
     281/     16A : 8E 06 50 01         	MOV	ES,[CURSEG]
     282/     16E : 8B 36 52 01         	MOV	SI,[DSADDR]
     283/     172 : 83 E6 F0            	AND	SI,0FFF0H
     284/     175 : 32 C0               	XOR	AL,AL
     285/     177 : A2 56 01            	MOV	[DSTATE],AL
     286/     17A :                     DPM0:
     287/     17A : E8 23 00            	CALL	DPL
     288/     17D : E8 EE 08            	CALL	CONST
     289/     180 : 0A C0               	OR	AL,AL
     290/     182 : 75 12               	JNZ	DPM1
     291/     184 : A0 56 01            	MOV	AL,[DSTATE]
     292/     187 : 3C 02               	CMP	AL,2
     293/     189 : 72 EF               	JC	DPM0
     294/     18B : 8B 1E 54 01         	MOV	BX,[DEADDR]
     295/     18F : 89 1E 52 01         	MOV	[DSADDR],BX
     296/     193 : E9 26 FF            	JMP	WSTART
     297/     196 :                     DPM1:
     298/     196 : 89 36 52 01         	MOV	[DSADDR],SI
     299/     19A : E8 C8 08            	CALL	CONIN
     300/     19D : E9 1C FF            	JMP	WSTART
     301/     1A0 :                     
     302/     1A0 :                     DPL:
     303/     1A0 :                     	;; DUMP	line
     304/     1A0 : A1 50 01            	MOV	AX,[CURSEG]
     305/     1A3 : E8 24 04            	CALL	HEXOUT4
     306/     1A6 : B0 3A               	MOV	AL,':'
     307/     1A8 : E8 C8 08            	CALL	CONOUT
     308/     1AB : 8B C6               	MOV	AX,SI
     309/     1AD : E8 1A 04            	CALL	HEXOUT4
     310/     1B0 : BB 3F 08            	MOV	BX,DSEP0
     311/     1B3 : E8 F9 03            	CALL	MSGOUT
     312/     1B6 : BF 00 01            	MOV	DI,INBUF
     313/     1B9 : B9 10 00            	MOV	CX,16
     314/     1BC :                     DPL0:
     315/     1BC : E8 28 00            	CALL	DPB
     316/     1BF : E2 FB               	LOOP	DPL0
     317/     1C1 :                     
     318/     1C1 : BB 42 08            	MOV	BX,DSEP1
     319/     1C4 : E8 E8 03            	CALL	MSGOUT
     320/     1C7 :                     
     321/     1C7 : BF 00 01            	MOV	DI,INBUF
     322/     1CA : B9 10 00            	MOV	CX,16
     323/     1CD :                     DPL1:
     324/     1CD : 8A 05               	MOV	AL,[DI]
     325/     1CF : 47                  	INC	DI
     326/     1D0 : 3C 20               	CMP	AL,' '
     327/     1D2 : 72 09               	JC	DPL2
     328/     1D4 : 3C 7F               	CMP	AL,7FH
     329/     1D6 : 73 05               	JNC	DPL2
     330/     1D8 : E8 98 08            	CALL	CONOUT
     331/     1DB : EB 05               	JMP	DPL3
     332/     1DD :                     DPL2:
     333/     1DD : B0 2E               	MOV	AL,'.'
     334/     1DF : E8 91 08            	CALL	CONOUT
     335/     1E2 :                     DPL3:
     336/     1E2 : E2 E9               	LOOP	DPL1
     337/     1E4 : E9 30 04            	JMP	CRLF
     338/     1E7 :                     
     339/     1E7 :                     DPB:
     340/     1E7 :                     	;; DUMP byte
     341/     1E7 : B0 20               	MOV	AL,' '
     342/     1E9 : E8 87 08            	CALL	CONOUT
     343/     1EC : A0 56 01            	MOV	AL,[DSTATE]
     344/     1EF : 0A C0               	OR	AL,AL
     345/     1F1 : 75 1A               	JNZ	DPB2
     346/     1F3 :                     	;; State 0
     347/     1F3 : 3B 36 52 01         	CMP	SI,[DSADDR]
     348/     1F7 : 74 0F               	JZ	DPB1
     349/     1F9 :                     DPB0:
     350/     1F9 :                     	;; Still 0 or 2
     351/     1F9 : B0 20               	MOV	AL,' '
     352/     1FB : 88 05               	MOV	[DI],AL
     353/     1FD : E8 73 08            	CALL	CONOUT
     354/     200 : B0 20               	MOV	AL,' '
     355/     202 : E8 6E 08            	CALL	CONOUT
     356/     205 : 46                  	INC	SI
     357/     206 : 47                  	INC	DI
     358/     207 : C3                  	RET
     359/     208 :                     DPB1:
     360/     208 :                     	;; Found start address
     361/     208 : B0 01               	MOV	AL,1
     362/     20A : A2 56 01            	MOV	[DSTATE],AL
     363/     20D :                     DPB2:
     364/     20D : A0 56 01            	MOV	AL,[DSTATE]
     365/     210 : 3C 01               	CMP	AL,1
     366/     212 : 75 E5               	JNZ	DPB0		; state 2
     367/     214 :                     	;; DUMP state 1
     368/     214 : 26 8A 04            	MOV	AL,ES:[SI]
     369/     217 : 88 05               	MOV	[DI],AL
     370/     219 : E8 B5 03            	CALL	HEXOUT2
     371/     21C : 46                  	INC	SI
     372/     21D : 47                  	INC	DI
     373/     21E :                     
     374/     21E : 3B 36 54 01         	CMP	SI,[DEADDR]
     375/     222 : 75 05               	JNZ	DPB3
     376/     224 :                     	;; Found end address
     377/     224 : B0 02               	MOV	AL,2
     378/     226 : A2 56 01            	MOV	[DSTATE],AL
     379/     229 :                     DPB3:
     380/     229 : C3                  	RET
     381/     22A :                     
     382/     22A :                     ;;;
     383/     22A :                     ;;; GO address
     384/     22A :                     ;;; 
     385/     22A :                     
     386/     22A :                     GO:
     387/     22A : 32 C0               	xor 	al, al
     388/     22C : A2 7C 01            	mov	[bflg], al
     389/     22F :                     
     390/     22F : 43                  	INC	BX
     391/     230 : E8 52 04            	CALL	RDHEX
     392/     233 : 0A C9               	OR	CL,CL
     393/     235 : 74 1D               	JZ	G1
     394/     237 : 8A 07               	MOV	AL,[BX]
     395/     239 : 3C 3A               	CMP	AL,':'
     396/     23B : 75 10               	JNE	G0
     397/     23D :                     
     398/     23D : 89 16 74 01         	MOV	[REGCS],DX
     399/     241 : 89 16 7E 01         	MOV	[brkcs],DX
     400/     245 : 43                  	INC	BX
     401/     246 : E8 3C 04            	CALL	RDHEX
     402/     249 : 0A C9               	OR	CL,CL
     403/     24B : 74 19               	JZ	GE
     404/     24D :                     G0:
     405/     24D : 89 16 72 01         	MOV	[REGIP],DX
     406/     251 : E8 1C 04            	CALL	SKIPSP
     407/     254 :                     G1:
     408/     254 : 8A 07               	MOV	AL,[BX]
     409/     256 : 0A C0               	or	al, al
     410/     258 : 74 37               	je	go_go
     411/     25A :                     
     412/     25A : 3C 2C               	CMP	AL,','
     413/     25C : 75 08               	JNZ	GE
     414/     25E :                     
     415/     25E : 43                  	INC	BX
     416/     25F : E8 23 04            	CALL	RDHEX
     417/     262 : 0A C9               	OR	CL,CL
     418/     264 : 75 03               	jnz	g2
     419/     266 :                     GE:
     420/     266 : E9 9C FE            	JMP	ERR
     421/     269 :                     
     422/     269 :                     g2:
     423/     269 : A1 74 01            	MOV	AX,[REGCS]
     424/     26C : A3 7E 01            	MOV	[brkcs],AX
     425/     26F : 8A 07               	MOV	AL,[BX]
     426/     271 : 3C 3A               	CMP	AL,':'
     427/     273 : 75 0C               	JNE	G0_0
     428/     275 :                     
     429/     275 : 89 16 7E 01         	MOV	[brkcs],DX
     430/     279 : 43                  	INC	BX
     431/     27A : E8 08 04            	CALL	RDHEX
     432/     27D : 0A C9               	OR	CL,CL
     433/     27F : 74 E5               	JZ	GE
     434/     281 :                     
     435/     281 :                     G0_0:
     436/     281 : 89 16 80 01         	MOV	[brkip],DX
     437/     285 : E8 E8 03            	CALL	SKIPSP
     438/     288 : 0A C0               	OR	AL,AL
     439/     28A : 75 DA               	JNZ	GE
     440/     28C :                     
     441/     28C : B0 01               	mov	al, 1
     442/     28E : A2 7C 01            	mov	[bflg], al
     443/     291 :                     
     444/     291 :                     go_go:
     445/     291 : A0 7C 01            	mov	al, [bflg]
     446/     294 : 0A C0               	or	al, al
     447/     296 : 74 14               	je	go_anywhere
     448/     298 :                     
     449/     298 :                     ; set break point
     450/     298 :                     
     451/     298 : A1 7E 01            	mov	ax, [brkcs]
     452/     29B : 8E C0               	mov	es, ax
     453/     29D : 8B 36 80 01         	mov	si, [brkip]
     454/     2A1 : 26 8A 04            	mov	al, es:[si]	; get a code at break point
     455/     2A4 : A2 7D 01            	mov	[bp_code], al
     456/     2A7 : B0 CC               	mov	al, 0CCH	; int 03h code
     457/     2A9 : 26 88 04            	mov	es:[si], al	; set break point
     458/     2AC :                     
     459/     2AC :                     go_anywhere:
     460/     2AC : E6 30               	out	NMI_SIG_OFF, al	; NMI LED OFF
     461/     2AE :                     
     462/     2AE : 8E 16 78 01         	MOV	SS,[REGSS]
     463/     2B2 : 8B 26 6A 01         	MOV	SP,[REGSP]
     464/     2B6 :                     	
     465/     2B6 : A1 68 01            	MOV	AX,[REGF]
     466/     2B9 : 50                  	PUSH	AX
     467/     2BA : A1 74 01            	MOV	AX,[REGCS]
     468/     2BD : 50                  	PUSH	AX
     469/     2BE : A1 72 01            	MOV	AX,[REGIP]
     470/     2C1 : 50                  	PUSH	AX
     471/     2C2 :                     
     472/     2C2 : A1 60 01            	MOV	AX,[REGAX]
     473/     2C5 : 8B 1E 62 01         	MOV	BX,[REGBX]
     474/     2C9 : 8B 0E 64 01         	MOV	CX,[REGCX]
     475/     2CD : 8B 16 66 01         	MOV	DX,[REGDX]
     476/     2D1 : 8B 2E 6C 01         	MOV	BP,[REGBP]
     477/     2D5 : 8B 36 6E 01         	MOV	SI,[REGSI]
     478/     2D9 : 8B 3E 70 01         	MOV	DI,[REGDI]
     479/     2DD : 8E 06 7A 01         	MOV	ES,[REGES]
     480/     2E1 : 8E 1E 76 01         	MOV	DS,[REGDS]
     481/     2E5 : CF                  	IRET
     482/     2E6 :                     
     483/     2E6 :                     ;;;
     484/     2E6 :                     ;;; SET memory
     485/     2E6 :                     ;;;
     486/     2E6 :                     
     487/     2E6 :                     SETM:
     488/     2E6 : 43                  	INC	BX
     489/     2E7 : E8 9B 03            	CALL	RDHEX
     490/     2EA : 0A C9               	OR	CL,CL
     491/     2EC : 74 1F               	JZ	SM1
     492/     2EE : 8A 07               	MOV	AL,[BX]
     493/     2F0 : 3C 3A               	CMP	AL,':'
     494/     2F2 : 75 0C               	JNE	SM0
     495/     2F4 : 89 16 50 01         	MOV	[CURSEG],DX
     496/     2F8 : 43                  	INC	BX
     497/     2F9 : E8 89 03            	CALL	RDHEX
     498/     2FC : 0A C9               	OR	CL,CL
     499/     2FE : 74 6D               	JZ	SME
     500/     300 :                     SM0:
     501/     300 : 89 16 5A 01         	MOV	[SADDR],DX
     502/     304 : E8 69 03            	CALL	SKIPSP
     503/     307 : 8A 07               	MOV	AL,[BX]
     504/     309 : 0A C0               	OR	AL,AL
     505/     30B : 75 60               	JNZ	SME
     506/     30D :                     SM1:
     507/     30D : A1 50 01            	MOV	AX,[CURSEG]
     508/     310 : 8E C0               	MOV	ES,AX
     509/     312 : E8 B5 02            	CALL	HEXOUT4
     510/     315 : B0 3A               	MOV	AL,':'
     511/     317 : E8 59 07            	CALL	CONOUT
     512/     31A : 8B 36 5A 01         	MOV	SI,[SADDR]
     513/     31E : 8B C6               	MOV	AX,SI
     514/     320 : E8 A7 02            	CALL	HEXOUT4
     515/     323 : BB 42 08            	MOV	BX,DSEP1
     516/     326 : E8 86 02            	CALL	MSGOUT
     517/     329 : 26 8A 04            	MOV	AL,ES:[SI]
     518/     32C : E8 A2 02            	CALL	HEXOUT2
     519/     32F : B0 20               	MOV	AL,' '
     520/     331 : E8 3F 07            	CALL	CONOUT
     521/     334 : E8 EA 02            	CALL	GETLIN
     522/     337 : BB 00 01            	MOV	BX,INBUF
     523/     33A : E8 33 03            	CALL	SKIPSP
     524/     33D : 8A 07               	MOV	AL,[BX]
     525/     33F : 0A C0               	OR	AL,AL
     526/     341 : 75 07               	JNZ	SM2
     527/     343 :                     	;; Empty (Increment address)
     528/     343 : 46                  	INC	SI
     529/     344 : 89 36 5A 01         	MOV	[SADDR],SI
     530/     348 : EB C3               	JMP	SM1
     531/     34A :                     SM2:
     532/     34A : 3C 2D               	CMP	AL,'-'
     533/     34C : 75 07               	JNZ	SM3
     534/     34E :                     	;; '-' (Decrement address)
     535/     34E : 4E                  	DEC	SI
     536/     34F : 89 36 5A 01         	MOV	[SADDR],SI
     537/     353 : EB B8               	JMP	SM1
     538/     355 :                     SM3:
     539/     355 : 3C 2E               	CMP	AL,'.'
     540/     357 : 75 03               	JNZ	SM4
     541/     359 :                     	;; '.' (Quit)
     542/     359 : E9 60 FD            	JMP	WSTART
     543/     35C :                     SM4:
     544/     35C : E8 26 03            	CALL	RDHEX
     545/     35F : 0A C9               	OR	CL,CL
     546/     361 : 74 0A               	JZ	SME
     547/     363 : 26 88 14            	MOV	ES:[SI],DL
     548/     366 : 46                  	INC	SI
     549/     367 : 89 36 5A 01         	MOV	[SADDR],SI
     550/     36B : EB A0               	JMP	SM1
     551/     36D :                     SME:
     552/     36D : E9 95 FD            	JMP	ERR
     553/     370 :                     
     554/     370 :                     ;;;
     555/     370 :                     ;;; LOAD HEX file
     556/     370 :                     ;;;
     557/     370 :                     
     558/     370 :                     LOADH:
     559/     370 : 43                  	INC	BX
     560/     371 : E8 11 03            	CALL	RDHEX
     561/     374 : 0A C9               	OR	CL,CL
     562/     376 : 74 14               	JZ	LH0
     563/     378 : 8A 07               	MOV	AL,[BX]
     564/     37A : 3C 3A               	CMP	AL,':'
     565/     37C : 75 10               	JNE	LH1
     566/     37E : 89 16 50 01         	MOV	[CURSEG],DX
     567/     382 : 43                  	INC	BX
     568/     383 : E8 FF 02            	CALL	RDHEX
     569/     386 : 0A C9               	OR	CL,CL
     570/     388 : 74 30               	JZ	LHE
     571/     38A : EB 02               	JMP	LH1
     572/     38C :                     LH0:
     573/     38C : 33 D2               	XOR	DX,DX
     574/     38E :                     LH1:
     575/     38E : 8A 07               	MOV	AL,[BX]
     576/     390 : 0A C0               	OR	AL,AL
     577/     392 : 75 26               	JNZ	LHE
     578/     394 : 8B F2               	MOV	SI,DX
     579/     396 : 8E 06 50 01         	MOV	ES,[CURSEG]
     580/     39A :                     
     581/     39A :                     LH2:	
     582/     39A : B0 2E               	mov	al, '.'
     583/     39C : E8 D4 06            	call	CONOUT
     584/     39F :                     	
     585/     39F : E8 C3 06            	CALL	CONIN
     586/     3A2 : E8 D5 02            	CALL	UPPER
     587/     3A5 : 3C 53               	CMP	AL,'S'
     588/     3A7 : 74 6B               	JE	LHS0
     589/     3A9 : 3C 3A               	CMP	AL,':'
     590/     3AB : 74 10               	JE	LHI0
     591/     3AD :                     LH3:
     592/     3AD :                     	;; Skip to EOL
     593/     3AD : 3C 0D               	CMP	AL,CR
     594/     3AF : 74 E9               	JE	LH2
     595/     3B1 : 3C 0A               	CMP	AL,LF
     596/     3B3 : 74 E5               	JE	LH2
     597/     3B5 : E8 AD 06            	CALL	CONIN
     598/     3B8 : EB F3               	JMP	LH3
     599/     3BA :                     LHE:
     600/     3BA : E9 48 FD            	JMP	ERR
     601/     3BD :                     
     602/     3BD :                     LHI0:
     603/     3BD : E8 2B 02            	CALL	HEXIN
     604/     3C0 : 8A C8               	MOV	CL,AL		; Checksum
     605/     3C2 : 8A D8               	MOV	BL,AL		; Length
     606/     3C4 :                     
     607/     3C4 : E8 24 02            	CALL	HEXIN
     608/     3C7 : 8A F0               	MOV	DH,AL		; Address H
     609/     3C9 : 02 C8               	ADD	CL,AL		; Checksum
     610/     3CB :                     
     611/     3CB : E8 1D 02            	CALL	HEXIN
     612/     3CE : 8A D0               	MOV	DL,AL		; Address L
     613/     3D0 : 02 C8               	ADD	CL,AL		; Checksum
     614/     3D2 :                     
     615/     3D2 : 8B FA               	MOV	DI,DX
     616/     3D4 : 03 FE               	ADD	DI,SI		; Add offset
     617/     3D6 :                     
     618/     3D6 : E8 12 02            	CALL	HEXIN
     619/     3D9 : A2 5F 01            	MOV	[RECTYP],AL	; Record Type
     620/     3DC : 02 C8               	ADD	CL,AL		; Checksum
     621/     3DE :                     
     622/     3DE : 0A DB               	OR	BL,BL		; Check length
     623/     3E0 : 74 15               	JZ	LHI3
     624/     3E2 :                     LHI1:
     625/     3E2 : E8 06 02            	CALL	HEXIN
     626/     3E5 : 02 C8               	ADD	CL,AL		; Checksum
     627/     3E7 :                     
     628/     3E7 : 8A 3E 5F 01         	MOV	BH,[RECTYP]
     629/     3EB : 0A FF               	OR	BH,BH
     630/     3ED : 75 04               	JNZ	LHI2
     631/     3EF :                     
     632/     3EF : 26 88 05            	MOV	ES:[DI],AL
     633/     3F2 : 47                  	INC	DI
     634/     3F3 :                     LHI2:
     635/     3F3 : FE CB               	DEC	BL
     636/     3F5 : 75 EB               	JNZ	LHI1
     637/     3F7 :                     LHI3:
     638/     3F7 : E8 F1 01            	CALL	HEXIN
     639/     3FA : 02 C1               	ADD	AL,CL
     640/     3FC : 75 0D               	JNZ	LHIE		; Checksum error
     641/     3FE : A0 5F 01            	MOV	AL,[RECTYP]
     642/     401 : 0A C0               	OR	AL,AL
     643/     403 : 74 A8               	JZ	LH3
     644/     405 :                     
     645/     405 :                     LHSR:
     646/     405 : E8 0F 02            	call	CRLF
     647/     408 : E9 B1 FC            	JMP	WSTART
     648/     40B :                     LHIE:
     649/     40B : BB 1D 08            	MOV	BX,IHEMSG
     650/     40E : E8 9E 01            	CALL	MSGOUT
     651/     411 : E9 A8 FC            	JMP	WSTART
     652/     414 :                     
     653/     414 :                     LHS0:
     654/     414 : E8 4E 06            	CALL	CONIN
     655/     417 : A2 5F 01            	MOV	[RECTYP],AL
     656/     41A :                     
     657/     41A : E8 CE 01            	CALL	HEXIN
     658/     41D : 8A D8               	MOV	BL,AL		; Length+3
     659/     41F : 8A C8               	MOV	CL,AL		; Checksum
     660/     421 :                     
     661/     421 : E8 C7 01            	CALL	HEXIN
     662/     424 : 8A F0               	MOV	DH,AL		; Address H
     663/     426 : 02 C8               	ADD	CL,AL		; Checksum
     664/     428 :                     	
     665/     428 : E8 C0 01            	CALL	HEXIN
     666/     42B : 8A D0               	MOV	DL,AL		; Address L
     667/     42D : 02 C8               	ADD	CL,AL		; Checksum
     668/     42F :                     
     669/     42F : 8B FA               	MOV	DI,DX
     670/     431 : 03 FE               	ADD	DI,SI		; Add offset
     671/     433 :                     
     672/     433 : 80 EB 03            	SUB	BL,3
     673/     436 : 72 2B               	JC	LHSE		; Length error
     674/     438 : 74 16               	JZ	LHS3
     675/     43A :                     LHS1:
     676/     43A : E8 AE 01            	CALL	HEXIN
     677/     43D : 02 C8               	ADD	CL,AL		; Checksum
     678/     43F :                     
     679/     43F : 8A 3E 5F 01         	MOV	BH,[RECTYP]
     680/     443 : 80 FF 31            	CMP	BH,'1'
     681/     446 : 75 04               	JNZ	LHS2
     682/     448 :                     
     683/     448 : 26 88 05            	MOV	ES:[DI],AL
     684/     44B : 47                  	INC	DI
     685/     44C :                     LHS2:
     686/     44C : FE CB               	DEC	BL
     687/     44E : 75 EA               	JNZ	LHS1
     688/     450 :                     LHS3:
     689/     450 : E8 98 01            	CALL	HEXIN
     690/     453 : 02 C1               	ADD	AL,CL
     691/     455 : 3C FF               	CMP	AL,0FFH
     692/     457 : 75 0A               	JNE	LHSE		; Checksum error
     693/     459 :                     
     694/     459 : A0 5F 01            	MOV	AL,[RECTYP]
     695/     45C : 3C 39               	CMP	AL,'9'
     696/     45E : 74 A5               	JZ	LHSR
     697/     460 : E9 4A FF            	JMP	LH3
     698/     463 :                     LHSE:
     699/     463 : BB 2A 08            	MOV	BX,SHEMSG
     700/     466 : E8 46 01            	CALL	MSGOUT
     701/     469 : E9 50 FC            	JMP	WSTART
     702/     46C :                     
     703/     46C :                     ;;;
     704/     46C :                     ;;; Register
     705/     46C :                     ;;; 
     706/     46C :                     REG:
     707/     46C : 43                  	INC	BX
     708/     46D : E8 00 02            	CALL	SKIPSP
     709/     470 : E8 07 02            	CALL	UPPER
     710/     473 : 0A C0               	OR	AL,AL
     711/     475 : 75 06               	JNE	RG0
     712/     477 : E8 7F 00            	CALL	RDUMP
     713/     47A : E9 3F FC            	JMP	WSTART
     714/     47D :                     RG0:
     715/     47D : BE 46 09            	MOV	SI,RNTAB
     716/     480 :                     RG1:
     717/     480 : 2E 3A 04            	CMP	AL,CS:[SI]
     718/     483 : 74 0D               	JE	RG2		; Character match
     719/     485 : 2E 8A 4C 01         	MOV	CL,CS:1[SI]
     720/     489 : 0A C9               	OR	CL,CL
     721/     48B : 74 69               	JE	RGE
     722/     48D : 83 C6 06            	ADD	SI,6
     723/     490 : EB EE               	JMP	RG1
     724/     492 :                     RG2:
     725/     492 : 2E 8A 44 01         	MOV	AL,CS:1[SI]
     726/     496 : 3C 0F               	CMP	AL,0FH
     727/     498 : 75 0C               	JNE	RG3
     728/     49A :                     	;; Next table
     729/     49A : 2E 8B 74 02         	MOV	SI,CS:2[SI]
     730/     49E : 43                  	INC	BX
     731/     49F : 8A 07               	MOV	AL,[BX]
     732/     4A1 : E8 D6 01            	CALL	UPPER
     733/     4A4 : EB DA               	JMP	RG1
     734/     4A6 :                     RG3:	
     735/     4A6 : 0A C0               	OR	AL,AL		; Found end mark
     736/     4A8 : 74 4C               	JE	RGE
     737/     4AA :                     
     738/     4AA : 2E 8A 4C 01         	MOV	CL,CS:1[SI]
     739/     4AE : 2E 8B 5C 04         	MOV	BX,CS:4[SI]
     740/     4B2 : E8 FA 00            	CALL	MSGOUT
     741/     4B5 : B0 3D               	MOV	AL,'='
     742/     4B7 : E8 B9 05            	CALL	CONOUT
     743/     4BA : 2E 8B 5C 02         	MOV	BX,CS:2[SI]
     744/     4BE : 80 E1 07            	AND	CL,07H
     745/     4C1 : 53                  	PUSH	BX
     746/     4C2 : 51                  	PUSH	CX
     747/     4C3 : 80 F9 01            	CMP	CL,1
     748/     4C6 : 75 07               	JNE	RG4
     749/     4C8 :                     	;; 8 bit register
     750/     4C8 : 8A 07               	MOV	AL,[BX]
     751/     4CA : E8 04 01            	CALL	HEXOUT2
     752/     4CD : EB 05               	JMP	RG5
     753/     4CF :                     RG4:
     754/     4CF :                     	;; 16 bit register
     755/     4CF : 8B 07               	MOV	AX,[BX]
     756/     4D1 : E8 F6 00            	CALL	HEXOUT4
     757/     4D4 :                     RG5:
     758/     4D4 : B0 20               	MOV	AL,' '
     759/     4D6 : E8 9A 05            	CALL	CONOUT
     760/     4D9 : E8 45 01            	CALL	GETLIN
     761/     4DC : BB 00 01            	MOV	BX,INBUF
     762/     4DF : E8 A3 01            	CALL	RDHEX
     763/     4E2 : 0A C9               	OR	CL,CL
     764/     4E4 : 74 0D               	JE	RGR
     765/     4E6 : 59                  	POP	CX
     766/     4E7 : 5B                  	POP	BX
     767/     4E8 : 80 F9 01            	CMP	CL,1
     768/     4EB : 75 04               	JNE	RG6
     769/     4ED :                     	;; 8 bit register
     770/     4ED : 88 17               	MOV	[BX],DL
     771/     4EF : EB 02               	JMP	RG7
     772/     4F1 :                     RG6:
     773/     4F1 :                     	;; 16 bit register
     774/     4F1 : 89 17               	MOV	[BX],DX
     775/     4F3 :                     RG7:
     776/     4F3 :                     RGR:
     777/     4F3 : E9 C6 FB            	JMP	WSTART
     778/     4F6 :                     RGE:
     779/     4F6 : E9 0C FC            	JMP	ERR
     780/     4F9 :                     	
     781/     4F9 :                     RDUMP:
     782/     4F9 : BE AE 08            	MOV	SI,RDTAB
     783/     4FC :                     RD0:	
     784/     4FC : 2E 8B 1C            	MOV	BX,CS:[SI]
     785/     4FF : 0B DB               	OR	BX,BX
     786/     501 : 74 11               	JZ	RD1
     787/     503 : E8 A9 00            	CALL	MSGOUT
     788/     506 : 46                  	INC	SI
     789/     507 : 46                  	INC	SI
     790/     508 : 2E 8B 1C            	MOV	BX,CS:[SI]
     791/     50B : 8B 07               	MOV	AX,[BX]
     792/     50D : E8 BA 00            	CALL	HEXOUT4
     793/     510 : 46                  	INC	SI
     794/     511 : 46                  	INC	SI
     795/     512 : EB E8               	JMP	RD0
     796/     514 :                     RD1:	
     797/     514 :                     ; Flag bit image
     798/     514 :                     
     799/     514 : BB 30 09            	mov	bx, FLGB
     800/     517 : E8 95 00            	CALL	MSGOUT		;" FLb="
     801/     51A :                     
     802/     51A : BF 82 01            	mov	di, F_bit
     803/     51D : BB 36 09            	mov	bx, Fbiton
     804/     520 : B1 10               	mov	cl, F_bitSize
     805/     522 : A1 68 01            	mov	ax, [REGF]
     806/     525 : 25 D5 0F            	and	ax, f_msk_bit
     807/     528 :                     
     808/     528 :                     fb_loop:
     809/     528 : D1 E0               	shl	ax, 1
     810/     52A : 72 05               	jc	rdf1
     811/     52C :                     
     812/     52C : C6 05 2E            	mov	byte ptr [di], '.'
     813/     52F : EB 05               	jmp	rdf2
     814/     531 :                     
     815/     531 :                     rdf1:
     816/     531 : 2E 8A 2F            	mov	ch, cs:[bx]
     817/     534 : 88 2D               	mov	[di], ch
     818/     536 :                     rdf2:
     819/     536 : 43                  	inc	bx
     820/     537 : 47                  	inc	di
     821/     538 : FE C9               	dec	cl
     822/     53A : 75 EC               	jnz	fb_loop
     823/     53C :                     
     824/     53C : C6 05 00            	mov	byte ptr [di],0
     825/     53F : BB 82 01            	mov	bx, F_bit
     826/     542 : E8 78 00            	CALL	STROUT		;"....ODITSZ.A.P.C"
     827/     545 :                     	
     828/     545 : E9 CF 00            	JMP	CRLF
     829/     548 :                     	
     830/     548 :                     ;;;
     831/     548 :                     ;;; T address
     832/     548 :                     ;;; 
     833/     548 :                     
     834/     548 :                     Trace:
     835/     548 : 43                  	INC	BX
     836/     549 : E8 39 01            	CALL	RDHEX
     837/     54C : 0A C9               	OR	CL,CL
     838/     54E : 74 19               	JZ	T1
     839/     550 : 8A 07               	MOV	AL,[BX]
     840/     552 : 3C 3A               	CMP	AL,':'
     841/     554 : 75 0C               	JNE	T0
     842/     556 :                     
     843/     556 : 89 16 74 01         	MOV	[REGCS],DX
     844/     55A : 43                  	INC	BX
     845/     55B : E8 27 01            	CALL	RDHEX
     846/     55E : 0A C9               	OR	CL,CL
     847/     560 : 74 0D               	JZ	TE
     848/     562 :                     T0:
     849/     562 : 89 16 72 01         	MOV	[REGIP],DX
     850/     566 : E8 07 01            	CALL	SKIPSP
     851/     569 :                     T1:
     852/     569 : 8A 07               	MOV	AL,[BX]
     853/     56B : 0A C0               	or	al, al
     854/     56D : 74 03               	je	To_go
     855/     56F :                     
     856/     56F :                     TE:
     857/     56F : E9 93 FB            	JMP	ERR
     858/     572 :                     
     859/     572 :                     To_go:
     860/     572 : E6 30               	out	NMI_SIG_OFF, al	; NMI LED OFF
     861/     574 :                     
     862/     574 : 8E 16 78 01         	MOV	SS,[REGSS]
     863/     578 : 8B 26 6A 01         	MOV	SP,[REGSP]
     864/     57C :                     	
     865/     57C : A1 68 01            	MOV	AX,[REGF]
     866/     57F : 0D 00 01            	or	ax, Tbit_ON_
     867/     582 :                     
     868/     582 : 50                  	PUSH	AX
     869/     583 : A1 74 01            	MOV	AX,[REGCS]
     870/     586 : 50                  	PUSH	AX
     871/     587 : A1 72 01            	MOV	AX,[REGIP]
     872/     58A : 50                  	PUSH	AX
     873/     58B :                     
     874/     58B : A1 60 01            	MOV	AX,[REGAX]
     875/     58E : 8B 1E 62 01         	MOV	BX,[REGBX]
     876/     592 : 8B 0E 64 01         	MOV	CX,[REGCX]
     877/     596 : 8B 16 66 01         	MOV	DX,[REGDX]
     878/     59A : 8B 2E 6C 01         	MOV	BP,[REGBP]
     879/     59E : 8B 36 6E 01         	MOV	SI,[REGSI]
     880/     5A2 : 8B 3E 70 01         	MOV	DI,[REGDI]
     881/     5A6 : 8E 06 7A 01         	MOV	ES,[REGES]
     882/     5AA : 8E 1E 76 01         	MOV	DS,[REGDS]
     883/     5AE : CF                  	IRET
     884/     5AF :                     
     885/     5AF :                     ;;;
     886/     5AF :                     ;;; Other support routines
     887/     5AF :                     ;;;
     888/     5AF :                     
     889/     5AF :                     MSGOUT:
     890/     5AF : 2E 8A 07            	MOV	AL,CS:[BX]
     891/     5B2 : 22 C0               	AND	AL,AL
     892/     5B4 : 74 06               	JZ	MSGOE
     893/     5B6 : E8 BA 04            	CALL	CONOUT
     894/     5B9 : 43                  	INC	BX
     895/     5BA : EB F3               	JMP	MSGOUT
     896/     5BC :                     MSGOE:
     897/     5BC : C3                  	RET
     898/     5BD :                     
     899/     5BD :                     STROUT:
     900/     5BD : 8A 07               	MOV	AL,[BX]
     901/     5BF : 22 C0               	AND	AL,AL
     902/     5C1 : 74 06               	JZ	STROE
     903/     5C3 : E8 AD 04            	CALL	CONOUT
     904/     5C6 : 43                  	INC	BX
     905/     5C7 : EB F4               	JMP	STROUT
     906/     5C9 :                     STROE:
     907/     5C9 : C3                  	RET
     908/     5CA :                     
     909/     5CA :                     HEXOUT4:
     910/     5CA : 50                  	PUSH	AX
     911/     5CB : 8A C4               	MOV	AL,AH
     912/     5CD : E8 01 00            	CALL	HEXOUT2
     913/     5D0 : 58                  	POP	AX
     914/     5D1 :                     HEXOUT2:
     915/     5D1 : 50                  	PUSH	AX
     916/     5D2 : D0 E8               	SHR	AL,1
     917/     5D4 : D0 E8               	SHR	AL,1
     918/     5D6 : D0 E8               	SHR	AL,1
     919/     5D8 : D0 E8               	SHR	AL,1
     920/     5DA : E8 01 00            	CALL	HEXOUT1
     921/     5DD : 58                  	POP	AX
     922/     5DE :                     HEXOUT1:
     923/     5DE : 24 0F               	AND	AL,0FH
     924/     5E0 : 04 30               	ADD	AL,'0'
     925/     5E2 : 3C 3A               	CMP	AL,'9'+1
     926/     5E4 : 72 02               	JC	HO10
     927/     5E6 : 04 07               	ADD	AL,'A'-'9'-1
     928/     5E8 :                     HO10:
     929/     5E8 : E9 88 04            	JMP	CONOUT
     930/     5EB :                     
     931/     5EB :                     HEXIN:
     932/     5EB : 32 C0               	XOR	AL,AL
     933/     5ED : E8 08 00            	CALL	HI0
     934/     5F0 : D0 E0               	SHL	AL,1
     935/     5F2 : D0 E0               	SHL	AL,1
     936/     5F4 : D0 E0               	SHL	AL,1
     937/     5F6 : D0 E0               	SHL	AL,1
     938/     5F8 :                     HI0:
     939/     5F8 : 8A E8               	MOV	CH,AL
     940/     5FA : E8 68 04            	CALL	CONIN
     941/     5FD : E8 7A 00            	CALL	UPPER
     942/     600 : 3C 30               	CMP	AL,'0'
     943/     602 : 72 12               	JC	HIR
     944/     604 : 3C 3A               	CMP	AL,'9'+1
     945/     606 : 72 0A               	JC	HI1
     946/     608 : 3C 41               	CMP	AL,'A'
     947/     60A : 72 0A               	JC	HIR
     948/     60C : 3C 47               	CMP	AL,'F'+1
     949/     60E : 73 06               	JNC	HIR
     950/     610 : 2C 07               	SUB	AL,'A'-'9'-1
     951/     612 :                     HI1:
     952/     612 : 2C 30               	SUB	AL,'0'
     953/     614 : 0A C5               	OR	AL,CH
     954/     616 :                     HIR:
     955/     616 : C3                  	RET
     956/     617 :                     
     957/     617 :                     CRLF:
     958/     617 : B0 0D               	MOV	AL,CR
     959/     619 : E8 57 04            	CALL	CONOUT
     960/     61C : B0 0A               	MOV	AL,LF
     961/     61E : E9 52 04            	JMP	CONOUT
     962/     621 :                     
     963/     621 :                     GETLIN:
     964/     621 : BB 00 01            	MOV	BX,INBUF
     965/     624 : 32 C9               	XOR	CL,CL
     966/     626 :                     GL0:
     967/     626 : E8 3C 04            	CALL	CONIN
     968/     629 : 3C 0D               	CMP	AL,CR
     969/     62B : 74 3B               	JZ	GLE
     970/     62D : 3C 0A               	CMP	AL,LF
     971/     62F : 74 37               	JZ	GLE
     972/     631 : 3C 08               	CMP	AL,BS
     973/     633 : 74 1B               	JZ	GLB
     974/     635 : 3C 7F               	CMP	AL,DEL
     975/     637 : 74 17               	JZ	GLB
     976/     639 : 3C 20               	CMP	AL,' '
     977/     63B : 72 E9               	JC	GL0
     978/     63D : 3C 80               	CMP	AL,80H
     979/     63F : 73 E5               	JNC	GL0
     980/     641 : 80 F9 4F            	CMP	CL,BUFLEN-1
     981/     644 : 73 E0               	JNC	GL0		; Too long
     982/     646 : 88 07               	MOV	[BX],AL
     983/     648 : E8 28 04            	CALL	CONOUT
     984/     64B : 43                  	INC	BX
     985/     64C : FE C1               	INC	CL
     986/     64E : EB D6               	JMP	GL0
     987/     650 :                     GLB:
     988/     650 : 22 C9               	AND	CL,CL
     989/     652 : 74 D2               	JZ	GL0
     990/     654 : 4B                  	DEC	BX
     991/     655 : FE C9               	DEC	CL
     992/     657 : B0 08               	MOV	AL,BS
     993/     659 : E8 17 04            	CALL	CONOUT
     994/     65C : B0 20               	MOV	AL,' '
     995/     65E : E8 12 04            	CALL	CONOUT
     996/     661 : B0 08               	MOV	AL,BS
     997/     663 : E8 0D 04            	CALL	CONOUT
     998/     666 : EB BE               	JMP	GL0
     999/     668 :                     GLE:
    1000/     668 : E8 AC FF            	CALL	CRLF
    1001/     66B : B0 00               	MOV	AL,00H
    1002/     66D : 88 07               	MOV	[BX],AL
    1003/     66F : C3                  	RET
    1004/     670 :                     	
    1005/     670 :                     SKIPSP:
    1006/     670 : 8A 07               	MOV	AL,[BX]
    1007/     672 : 3C 20               	CMP	AL,' '
    1008/     674 : 75 03               	JNE	SSR
    1009/     676 : 43                  	INC	BX
    1010/     677 : EB F7               	JMP	SKIPSP
    1011/     679 :                     SSR:
    1012/     679 : C3                  	RET
    1013/     67A :                     
    1014/     67A :                     UPPER:
    1015/     67A : 3C 61               	CMP	AL,'a'
    1016/     67C : 72 06               	JC	UPR
    1017/     67E : 3C 7B               	CMP	AL,'z'+1
    1018/     680 : 73 02               	JNC	UPR
    1019/     682 : 04 E0               	ADD	AL,'A'-'a'
    1020/     684 :                     UPR:
    1021/     684 : C3                  	RET
    1022/     685 :                     
    1023/     685 :                     RDHEX:
    1024/     685 : E8 E8 FF            	CALL	SKIPSP
    1025/     688 : 32 C9               	XOR	CL,CL
    1026/     68A : 33 D2               	XOR	DX,DX
    1027/     68C :                     RH0:
    1028/     68C : 8A 07               	MOV	AL,[BX]
    1029/     68E : E8 E9 FF            	CALL	UPPER
    1030/     691 : 3C 30               	CMP	AL,'0'
    1031/     693 : 72 1F               	JC	RHE
    1032/     695 : 3C 3A               	CMP	AL,'9'+1
    1033/     697 : 72 0A               	JC	RH1
    1034/     699 : 3C 41               	CMP	AL,'A'
    1035/     69B : 72 17               	JC	RHE
    1036/     69D : 3C 47               	CMP	AL,'F'+1
    1037/     69F : 73 13               	JNC	RHE
    1038/     6A1 : 2C 07               	SUB	AL,'A'-'9'-1
    1039/     6A3 :                     RH1:
    1040/     6A3 : 2C 30               	SUB	AL,'0'
    1041/     6A5 : D1 E2               	SHL	DX,1
    1042/     6A7 : D1 E2               	SHL	DX,1
    1043/     6A9 : D1 E2               	SHL	DX,1
    1044/     6AB : D1 E2               	SHL	DX,1
    1045/     6AD : 0A D0               	OR	DL,AL
    1046/     6AF : 43                  	INC	BX
    1047/     6B0 : FE C1               	INC	CL
    1048/     6B2 : EB D8               	JMP	RH0
    1049/     6B4 :                     RHE:
    1050/     6B4 : C3                  	RET
    1051/     6B5 :                     
    1052/     6B5 :                     ;-----------------------
    1053/     6B5 :                     ; INT 21H function call 
    1054/     6B5 :                     ;-----------------------
    1055/     6B5 :                     INTFNC:
    1056/     6B5 :                     	; get a charactor : AH = 7
    1057/     6B5 :                     	; return AL : charactor
    1058/     6B5 : 80 FC 07            	cmp	ah, 7
    1059/     6B8 : 75 04               	jnz	nfnc1
    1060/     6BA : E8 A8 03            	call	CONIN
    1061/     6BD : CF                  	iret
    1062/     6BE :                     nfnc1:
    1063/     6BE :                     	; put a charactor : AH = 2
    1064/     6BE :                     	; input : DL : charactor
    1065/     6BE : 80 FC 02            	cmp	ah, 2
    1066/     6C1 : 75 06               	jnz	nfnc2		; no support function
    1067/     6C3 : 8A C2               	mov	al, dl
    1068/     6C5 : E8 AB 03            	call	CONOUT
    1069/     6C8 : CF                  	iret
    1070/     6C9 :                     
    1071/     6C9 :                     nfnc2:
    1072/     6C9 :                     	; check key status : AH = 0BH
    1073/     6C9 :                     	; OUTPUT : AL : 0     ( key is not exist )
    1074/     6C9 :                     	;             : 0FFH  ( key is exist )
    1075/     6C9 : 80 FC 0B            	cmp	ah, 0BH
    1076/     6CC : 75 07               	jnz	nfnc3		; no support function
    1077/     6CE : E8 9D 03            	call	CONST
    1078/     6D1 : 74 02               	jz	nfnc3
    1079/     6D3 : B0 FF               	mov	al, 0FFH
    1080/     6D5 :                     
    1081/     6D5 :                     nfnc3:
    1082/     6D5 :                     
    1083/     6D5 : 80 FC 00            	cmp	ah, 0
    1084/     6D8 : 75 0D               	jnz	nfnc4
    1085/     6DA :                     
    1086/     6DA : B8 30 FF            	MOV	AX,MON_DSEG
    1087/     6DD : 8E D8               	MOV	DS,AX
    1088/     6DF : 8E D0               	MOV	SS,AX
    1089/     6E1 : BC 00 01            	MOV	SP,STACK
    1090/     6E4 : E9 B1 00            	jmp	chk_bpt
    1091/     6E7 :                     
    1092/     6E7 :                     nfnc4:
    1093/     6E7 : CF                  	iret
    1094/     6E8 :                     	
    1095/     6E8 :                     ;;;
    1096/     6E8 :                     ;;; Interrupt Handler
    1097/     6E8 :                     ;;;
    1098/     6E8 :                     
    1099/     6E8 :                     	;; Divide error (INT 00H)
    1100/     6E8 :                     INTDIV:
    1101/     6E8 : 50                  	PUSH	AX
    1102/     6E9 : 1E                  	PUSH	DS
    1103/     6EA : B8 30 FF            	MOV	AX,MON_DSEG
    1104/     6ED : 8E D8               	MOV	DS,AX
    1105/     6EF : 89 1E 62 01         	MOV	[REGBX],BX
    1106/     6F3 : 89 0E 64 01         	MOV	[REGCX],CX
    1107/     6F7 : BB 75 08            	MOV	BX,DIVMSG
    1108/     6FA : 33 C9               	XOR	CX,CX		; IP adjustment
    1109/     6FC : EB 57               	JMP	INT0
    1110/     6FE :                     	
    1111/     6FE :                     	;; Single step (INT 01H)
    1112/     6FE :                     INTSTP:
    1113/     6FE : 50                  	PUSH	AX
    1114/     6FF : 1E                  	PUSH	DS
    1115/     700 : B8 30 FF            	MOV	AX,MON_DSEG
    1116/     703 : 8E D8               	MOV	DS,AX
    1117/     705 : 89 1E 62 01         	MOV	[REGBX],BX
    1118/     709 : 89 0E 64 01         	MOV	[REGCX],CX
    1119/     70D : BB 86 08            	MOV	BX,STPMSG
    1120/     710 : 33 C9               	XOR	CX,CX		; IP adjustment
    1121/     712 : EB 41               	JMP	INT0
    1122/     714 :                     	
    1123/     714 :                     	;; NMI (INT 02H)
    1124/     714 :                     INTNMI:
    1125/     714 : 50                  	PUSH	AX
    1126/     715 : 1E                  	PUSH	DS
    1127/     716 : B8 30 FF            	MOV	AX,MON_DSEG
    1128/     719 : 8E D8               	MOV	DS,AX
    1129/     71B : 89 1E 62 01         	MOV	[REGBX],BX
    1130/     71F : 89 0E 64 01         	MOV	[REGCX],CX
    1131/     723 : BB 8F 08            	MOV	BX,NMIMSG
    1132/     726 : 33 C9               	XOR	CX,CX		; IP adjustment
    1133/     728 : EB 2B               	JMP	INT0
    1134/     72A :                     	
    1135/     72A :                     	;; Break (INT 03H)
    1136/     72A :                     INTBRK:
    1137/     72A : 50                  	PUSH	AX
    1138/     72B : 1E                  	PUSH	DS
    1139/     72C : B8 30 FF            	MOV	AX,MON_DSEG
    1140/     72F : 8E D8               	MOV	DS,AX
    1141/     731 : 89 1E 62 01         	MOV	[REGBX],BX
    1142/     735 : 89 0E 64 01         	MOV	[REGCX],CX
    1143/     739 : BB 97 08            	MOV	BX,BRKMSG
    1144/     73C : B9 01 00            	MOV	CX,1		; IP adjustment
    1145/     73F : EB 14               	JMP	INT0
    1146/     741 :                     	
    1147/     741 :                     	;; Overflow (INT 04H)
    1148/     741 :                     INTOVF:
    1149/     741 : 50                  	PUSH	AX
    1150/     742 : 1E                  	PUSH	DS
    1151/     743 : B8 30 FF            	MOV	AX,MON_DSEG
    1152/     746 : 8E D8               	MOV	DS,AX
    1153/     748 : 89 1E 62 01         	MOV	[REGBX],BX
    1154/     74C : 89 0E 64 01         	MOV	[REGCX],CX
    1155/     750 : BB A1 08            	MOV	BX,OVFMSG
    1156/     753 : 33 C9               	XOR	CX,CX		; IP adjustment
    1157/     755 :                     INT0:
    1158/     755 : 58                  	POP	AX
    1159/     756 : A3 76 01            	MOV	[REGDS],AX
    1160/     759 : 58                  	POP	AX
    1161/     75A : A3 60 01            	MOV	[REGAX],AX
    1162/     75D : 89 16 66 01         	MOV	[REGDX],DX
    1163/     761 :                     
    1164/     761 : 89 2E 6C 01         	MOV	[REGBP],BP
    1165/     765 : 89 36 6E 01         	MOV	[REGSI],SI
    1166/     769 : 89 3E 70 01         	MOV	[REGDI],DI
    1167/     76D : 8C 06 7A 01         	MOV	[REGES],ES
    1168/     771 :                     
    1169/     771 : 58                  	POP	AX
    1170/     772 : 2B C1               	SUB	AX,CX
    1171/     774 : A3 72 01            	MOV	[REGIP],AX
    1172/     777 : 58                  	POP	AX
    1173/     778 : A3 74 01            	MOV	[REGCS],AX
    1174/     77B : 58                  	POP	AX
    1175/     77C : 25 D5 0E            	and	ax,Tbit_OFF	; trace mode off
    1176/     77F :                     
    1177/     77F : A3 68 01            	MOV	[REGF],AX
    1178/     782 :                     
    1179/     782 : 89 26 6A 01         	MOV	[REGSP],SP
    1180/     786 : 8C 16 78 01         	MOV	[REGSS],SS
    1181/     78A :                     
    1182/     78A : B8 30 FF            	mov	ax, MON_DSEG
    1183/     78D : 8E D0               	mov	ss, ax
    1184/     78F : BC 00 01            	mov	sp, STACK
    1185/     792 : E8 1A FE            	CALL	MSGOUT
    1186/     795 : E8 61 FD            	CALL	RDUMP
    1187/     798 :                     
    1188/     798 :                     ; check break point
    1189/     798 :                     
    1190/     798 :                     chk_bpt:
    1191/     798 : A0 7C 01            	mov	al, [bflg]
    1192/     79B : 0A C0               	or	al, al
    1193/     79D : 74 14               	je	nobrkp
    1194/     79F :                     
    1195/     79F :                     ; restore a original code at break point
    1196/     79F :                     
    1197/     79F : A1 7E 01            	mov	ax, [brkcs]
    1198/     7A2 : 8E C0               	mov	es, ax
    1199/     7A4 : 8B 36 80 01         	mov	si, [brkip]
    1200/     7A8 : A0 7D 01            	mov	al, [bp_code]
    1201/     7AB : 26 88 04            	mov	es:[si], al	; restore a original code
    1202/     7AE : 32 C0               	xor	al, al
    1203/     7B0 : A2 7C 01            	mov	[bflg], al	; clear break flag
    1204/     7B3 :                     
    1205/     7B3 :                     nobrkp:
    1206/     7B3 : E9 06 F9            	JMP	WSTART
    1207/     7B6 :                     
    1208/     7B6 :                     	;; Dummy
    1209/     7B6 :                     INTDMY:
    1210/     7B6 : CF                  	IRET
    1211/     7B7 :                     	
    1212/     7B7 : =>TRUE               	if CPM86
    1213/     7B7 :                     invoke_msg:
    1214/     7B7 : 4E 6F 77 20 69 6E   	db	"Now invoking Operating System...",CR,LF,0
              7BD : 76 6F 6B 69 6E 67 
              7C3 : 20 4F 70 65 72 61 
              7C9 : 74 69 6E 67 20 53 
              7CF : 79 73 74 65 6D 2E 
              7D5 : 2E 2E 0D 0A 00    
    1215/     7DA : [1212]               	endif
    1216/     7DA :                     
    1217/     7DA :                     OPNMSG:
    1218/     7DA : 0D 0A 55 6E 69 76   	DB	CR,LF,"Universal Monitor 8088/V20 Edition",CR,LF, 00H
              7E0 : 65 72 73 61 6C 20 
              7E6 : 4D 6F 6E 69 74 6F 
              7EC : 72 20 38 30 38 38 
              7F2 : 2F 56 32 30 20 45 
              7F8 : 64 69 74 69 6F 6E 
              7FE : 0D 0A 00          
    1219/     801 :                     
    1220/     801 :                     cpu_msg:
    1221/     801 : 43 50 55 20 54 59   	db	"CPU TYPE : ", 00h
              807 : 50 45 20 3A 20 00 
    1222/     80D : 38 30 38 38 0D 0A   IM88:	DB	"8088",CR,LF,00H
              813 : 00                
    1223/     814 : 56 32 30 0D 0A 00   IMV20:	DB	"V20",CR,LF,00H
    1224/     81A :                     
    1225/     81A :                     PROMPT:
    1226/     81A : 5D 20 00            	DB	"] ",00H
    1227/     81D :                     
    1228/     81D :                     IHEMSG:
    1229/     81D : 45 72 72 6F 72 20   	DB	"Error ihex",CR,LF,00H
              823 : 69 68 65 78 0D 0A 
              829 : 00                
    1230/     82A :                     SHEMSG:
    1231/     82A : 45 72 72 6F 72 20   	DB	"Error srec",CR,LF,00H
              830 : 73 72 65 63 0D 0A 
              836 : 00                
    1232/     837 :                     ERRMSG:
    1233/     837 : 45 72 72 6F 72 0D   	DB	"Error",CR,LF,00H
              83D : 0A 00             
    1234/     83F :                     
    1235/     83F :                     DSEP0:
    1236/     83F : 20 3A 00            	DB	" :",00H
    1237/     842 :                     DSEP1:
    1238/     842 : 20 3A 20 00         	DB	" : ",00H
    1239/     846 :                     IHEXER:
    1240/     846 : 3A 30 30 30 30 30           DB	":00000001FF",CR,LF,00H
              84C : 30 30 31 46 46 0D 
              852 : 0A 00             
    1241/     854 :                     SRECER:
    1242/     854 : 53 39 30 33 30 30           DB	"S9030000FC",CR,LF,00H
              85A : 30 30 46 43 0D 0A 
              860 : 00                
    1243/     861 :                     
    1244/     861 :                     INIVEC:
    1245/     861 : E8 06 50 FF         	DW	INTDIV, MON_CSEG	; 00H Divide error
    1246/     865 : FE 06 50 FF         	DW	INTSTP, MON_CSEG	; 01H Single step
    1247/     869 : 14 07 50 FF         	DW	INTNMI, MON_CSEG	; 02H NMI
    1248/     86D : 2A 07 50 FF         	DW	INTBRK, MON_CSEG	; 03H Breakpoint
    1249/     871 : 41 07 50 FF         	DW	INTOVF, MON_CSEG	; 04H Overflow
    1250/     875 :                     INIVECE:
    1251/     875 :                     	
    1252/     875 : 0D 0A 44 69 76 69   DIVMSG:	DB	CR,LF,"Divide error",CR,LF,00H
              87B : 64 65 20 65 72 72 
              881 : 6F 72 0D 0A 00    
    1253/     886 : 0D 0A 53 74 65 70   STPMSG:	DB	CR,LF,"Step",CR,LF,00H
              88C : 0D 0A 00          
    1254/     88F : 0D 0A 4E 4D 49 0D   NMIMSG:	DB	CR,LF,"NMI",CR,LF,00H
              895 : 0A 00             
    1255/     897 : 0D 0A 42 72 65 61   BRKMSG:	DB	CR,LF,"Break",CR,LF,00H
              89D : 6B 0D 0A 00       
    1256/     8A1 : 0D 0A 4F 76 65 72   OVFMSG:	DB	CR,LF,"Overflow",CR,LF,00H
              8A7 : 66 6C 6F 77 0D 0A 
              8AD : 00                
    1257/     8AE :                     
    1258/     8AE : EA 08 60 01         RDTAB:	DW	RDSAX, REGAX
    1259/     8B2 : EE 08 62 01         	DW	RDSBX, REGBX
    1260/     8B6 : F3 08 64 01         	DW	RDSCX, REGCX
    1261/     8BA : F8 08 66 01         	DW	RDSDX, REGDX
    1262/     8BE : FD 08 68 01         	DW	RDSF,  REGF
    1263/     8C2 : 02 09 74 01         	DW	RDSCS, REGCS
    1264/     8C6 : 07 09 76 01         	DW	RDSDS, REGDS
    1265/     8CA : 0C 09 78 01         	DW	RDSSS, REGSS
    1266/     8CE : 11 09 7A 01         	DW	RDSES, REGES
    1267/     8D2 : 16 09 6A 01         	DW	RDSSP, REGSP
    1268/     8D6 : 1C 09 6C 01         	DW	RDSBP, REGBP
    1269/     8DA : 21 09 6E 01         	DW	RDSSI, REGSI
    1270/     8DE : 26 09 70 01         	DW	RDSDI, REGDI
    1271/     8E2 : 2B 09 72 01         	DW	RDSIP, REGIP
    1272/     8E6 :                     	
    1273/     8E6 : 00 00 00 00         	DW	0000H, 0000H
    1274/     8EA :                     
    1275/     8EA : 41 58 3D 00         RDSAX:	DB	"AX=",00H
    1276/     8EE : 20 42 58 3D 00      RDSBX:	DB	" BX=",00H
    1277/     8F3 : 20 43 58 3D 00      RDSCX:	DB	" CX=",00H
    1278/     8F8 : 20 44 58 3D 00      RDSDX:	DB	" DX=",00H
    1279/     8FD : 20 46 4C 3D 00      RDSF:	DB	" FL=",00H
    1280/     902 : 20 43 53 3D 00      RDSCS:	DB	" CS=",00H
    1281/     907 : 20 44 53 3D 00      RDSDS:	DB	" DS=",00H
    1282/     90C : 20 53 53 3D 00      RDSSS:	DB	" SS=",00H
    1283/     911 : 20 45 53 3D 00      RDSES:	DB	" ES=",00H
    1284/     916 : 0D 0A 53 50 3D 00   RDSSP:	DB	CR,LF,"SP=",00H
    1285/     91C : 20 42 50 3D 00      RDSBP:	DB	" BP=",00H
    1286/     921 : 20 53 49 3D 00      RDSSI:	DB	" SI=",00H
    1287/     926 : 20 44 49 3D 00      RDSDI:	DB	" DI=",00H
    1288/     92B : 20 49 50 3D 00      RDSIP:	DB	" IP=",00H
    1289/     930 :                     
    1290/     930 : 20 46 4C 62 3D 00   FLGB:	db	" FLb=",00h
    1291/     936 : 2E 2E 2E 2E 4F 44   Fbiton:	db	"....ODITSZ.A.P.C"
              93C : 49 54 53 5A 2E 41 
              942 : 2E 50 2E 43       
    1292/     946 :                     
    1293/     946 :                     
    1294/     946 :                     RNTAB:
    1295/     946 : 41 0F               	DB	'A',0FH		; "A?"
    1296/     948 : 7C 09 00 00         	DW	RNTABA,0
    1297/     94C : 42 0F               	DB	'B',0FH		; "B?"
    1298/     94E : 94 09 00 00         	DW	RNTABB,0
    1299/     952 : 43 0F               	DB	'C',0FH		; "C?"
    1300/     954 : B2 09 00 00         	DW	RNTABC,0
    1301/     958 : 44 0F               	DB	'D',0FH		; "D?"
    1302/     95A : D0 09 00 00         	DW	RNTABD,0
    1303/     95E : 45 0F               	DB	'E',0FH		; "E?"
    1304/     960 : D0 09 00 00         	DW	RNTABD,0
    1305/     964 : 46 02               	DB	'F',2		; "F"
    1306/     966 : 68 01 57 0A         	DW	REGF,RNF
    1307/     96A : 49 0F               	DB	'I',0FH		; "I?"
    1308/     96C : 00 0A 00 00         	DW	RNTABI,0
    1309/     970 : 53 0F               	DB	'S',0FH		; "S?"
    1310/     972 : 0C 0A 00 00         	DW	RNTABS,0
    1311/     976 :                     
    1312/     976 : 00 00               	DB	00H,0		; End mark
    1313/     978 : 00 00 00 00         	DW	0,0
    1314/     97C :                     	
    1315/     97C :                     RNTABA:
    1316/     97C : 58 02               	DB	'X',2		; "AX"
    1317/     97E : 60 01 24 0A         	DW	REGAX,RNAX
    1318/     982 : 48 01               	DB	'H',1		; "AH"
    1319/     984 : 61 01 27 0A         	DW	REGAX+1,RNAH
    1320/     988 : 4C 01               	DB	'L',1		; "AL"
    1321/     98A : 60 01 2A 0A         	DW	REGAX,RNAL
    1322/     98E :                     
    1323/     98E : 00 00               	DB	00H,0		; End mark
    1324/     990 : 00 00 00 00         	DW	0,0
    1325/     994 :                     
    1326/     994 :                     RNTABB:
    1327/     994 : 58 02               	DB	'X',2		; "BX"
    1328/     996 : 62 01 2D 0A         	DW	REGBX,RNBX
    1329/     99A : 48 01               	DB	'H',1		; "BH"
    1330/     99C : 63 01 30 0A         	DW	REGBX+1,RNBH
    1331/     9A0 : 4C 01               	DB	'L',1		; "BL"
    1332/     9A2 : 62 01 33 0A         	DW	REGBX,RNBL
    1333/     9A6 : 50 02               	DB	'P',2		; "BP"
    1334/     9A8 : 6C 01 36 0A         	DW	REGBP,RNBP
    1335/     9AC :                     	
    1336/     9AC : 00 00               	DB	00H,0		; End mark
    1337/     9AE : 00 00 00 00         	DW	0,0
    1338/     9B2 :                     
    1339/     9B2 :                     RNTABC:
    1340/     9B2 : 58 02               	DB	'X',2		; "CX"
    1341/     9B4 : 64 01 39 0A         	DW	REGCX,RNCX
    1342/     9B8 : 48 01               	DB	'H',1		; "CH"
    1343/     9BA : 65 01 3C 0A         	DW	REGCX+1,RNCH
    1344/     9BE : 4C 01               	DB	'L',1		; "CL"
    1345/     9C0 : 64 01 3F 0A         	DW	REGCX,RNCL
    1346/     9C4 : 53 02               	DB	'S',2		; "CS"
    1347/     9C6 : 74 01 42 0A         	DW	REGCS,RNCS
    1348/     9CA :                     	
    1349/     9CA : 00 00               	DB	00H,0		; End mark
    1350/     9CC : 00 00 00 00         	DW	0,0
    1351/     9D0 :                     	
    1352/     9D0 :                     RNTABD:
    1353/     9D0 : 58 02               	DB	'X',2		; "DX"
    1354/     9D2 : 66 01 45 0A         	DW	REGDX,RNDX
    1355/     9D6 : 48 01               	DB	'H',1		; "DH"
    1356/     9D8 : 67 01 48 0A         	DW	REGDX+1,RNDH
    1357/     9DC : 4C 01               	DB	'L',1		; "DL"
    1358/     9DE : 66 01 4B 0A         	DW	REGDX,RNDL
    1359/     9E2 : 49 02               	DB	'I',2		; "DI"
    1360/     9E4 : 70 01 4E 0A         	DW	REGDI,RNDI
    1361/     9E8 : 53 02               	DB	'S',2		; "DS"
    1362/     9EA : 76 01 51 0A         	DW	REGDS,RNDS
    1363/     9EE :                     	
    1364/     9EE : 00 00               	DB	00H,0		; End mark
    1365/     9F0 : 00 00 00 00         	DW	0,0
    1366/     9F4 :                     
    1367/     9F4 :                     RNTABE:
    1368/     9F4 : 53 02               	DB	'S',2		; "ES"
    1369/     9F6 : 7A 01 54 0A         	DW	REGES,RNES
    1370/     9FA :                     	
    1371/     9FA : 00 00               	DB	00H,0		; End mark
    1372/     9FC : 00 00 00 00         	DW	0,0
    1373/     A00 :                     	
    1374/     A00 :                     RNTABI:
    1375/     A00 : 50 02               	DB	'P',2		; "IP"
    1376/     A02 : 72 01 59 0A         	DW	REGIP,RNIP
    1377/     A06 :                     	
    1378/     A06 : 00 00               	DB	00H,0		; End mark
    1379/     A08 : 00 00 00 00         	DW	0,0
    1380/     A0C :                     	
    1381/     A0C :                     RNTABS:
    1382/     A0C : 49 02               	DB	'I',2		; "SI"
    1383/     A0E : 6E 01 5C 0A         	DW	REGSI,RNSI
    1384/     A12 : 50 02               	DB	'P',2		; "SP"
    1385/     A14 : 6A 01 5F 0A         	DW	REGSP,RNSP
    1386/     A18 : 53 02               	DB	'S',2		; "SS"
    1387/     A1A : 78 01 62 0A         	DW	REGSS,RNSS
    1388/     A1E :                     	
    1389/     A1E : 00 00               	DB	00H,0		; End mark
    1390/     A20 : 00 00 00 00         	DW	0,0
    1391/     A24 :                     	
    1392/     A24 : 41 58 00            RNAX:	DB	"AX",00H
    1393/     A27 : 41 48 00            RNAH:	DB	"AH",00H
    1394/     A2A : 41 4C 00            RNAL:	DB	"AL",00H
    1395/     A2D : 42 58 00            RNBX:	DB	"BX",00H
    1396/     A30 : 42 48 00            RNBH:	DB	"BH",00H
    1397/     A33 : 42 4C 00            RNBL:	DB	"BL",00H
    1398/     A36 : 42 50 00            RNBP:	DB	"BP",00H
    1399/     A39 : 43 58 00            RNCX:	DB	"CX",00H
    1400/     A3C : 43 48 00            RNCH:	DB	"CH",00H
    1401/     A3F : 43 4C 00            RNCL:	DB	"CL",00H
    1402/     A42 : 43 53 00            RNCS:	DB	"CS",00H
    1403/     A45 : 44 58 00            RNDX:	DB	"DX",00H
    1404/     A48 : 44 48 00            RNDH:	DB	"DH",00H
    1405/     A4B : 44 4C 00            RNDL:	DB	"DL",00H
    1406/     A4E : 44 49 00            RNDI:	DB	"DI",00H
    1407/     A51 : 44 53 00            RNDS:	DB	"DS",00H
    1408/     A54 : 45 53 00            RNES:	DB	"ES",00H
    1409/     A57 : 46 00               RNF:	DB	"F",00H
    1410/     A59 : 49 50 00            RNIP:	DB	"IP",00H
    1411/     A5C : 53 49 00            RNSI:	DB	"SI",00H
    1412/     A5F : 53 50 00            RNSP:	DB	"SP",00H
    1413/     A62 : 53 53 00            RNSS:	DB	"SS",00H
    1414/     A65 :                     
    1415/     A65 :                     CONIN:
    1416/     A65 :                     
    1417/     A65 : E4 02               	IN	AL,USARTC
    1418/     A67 : 24 01               	AND	AL,01h		; U3RXIF = 1?
    1419/     A69 :                     
    1420/     A69 : 74 FA               	JZ	CONIN
    1421/     A6B : E4 00               	IN	AL,USARTD
    1422/     A6D :                     
    1423/     A6D : C3                  	RET
    1424/     A6E :                     
    1425/     A6E :                     CONST:
    1426/     A6E : E4 02               	IN	AL,USARTC
    1427/     A70 : 24 01               	AND	AL,01h		; check U3RXIF
    1428/     A72 : C3                  	RET
    1429/     A73 :                     
    1430/     A73 :                     CONOUT:
    1431/     A73 : 8A E0               	mov	ah, al
    1432/     A75 :                     COUT0:	
    1433/     A75 : E4 02               	IN	AL,USARTC
    1434/     A77 : 24 02               	and	al, 02h		; check U3TXIF
    1435/     A79 : 74 FA               	JZ	COUT0
    1436/     A7B :                     
    1437/     A7B : 8A C4               	mov	al, ah
    1438/     A7D : E6 00               	OUT	USARTD,AL
    1439/     A7F :                     
    1440/     A7F : C3                  	RET
    1441/     A80 :                     
    1442/     A80 : =0AF0H               reset_vec	equ 0ffff0h-MON_CSEG*16
    1443/     A80 :                     
    1444/     A80 : FF FF FF FF FF FF   	db	reset_vec - $ dup(0FFH)
              A86 : FF FF FF FF FF FF 
              A8C : FF FF FF FF FF FF 
              A92 : FF FF FF FF FF FF 
              A98 : FF FF FF FF FF FF 
              A9E : FF FF FF FF FF FF 
              AA4 : FF FF FF FF FF FF 
              AAA : FF FF FF FF FF FF 
              AB0 : FF FF FF FF FF FF 
              AB6 : FF FF FF FF FF FF 
              ABC : FF FF FF FF FF FF 
              AC2 : FF FF FF FF FF FF 
              AC8 : FF FF FF FF FF FF 
              ACE : FF FF FF FF FF FF 
              AD4 : FF FF FF FF FF FF 
              ADA : FF FF FF FF FF FF 
              AE0 : FF FF FF FF FF FF 
              AE6 : FF FF FF FF FF FF 
              AEC : FF FF FF FF       
    1445/     AF0 :                     
    1446/     AF0 :                     	;;
    1447/     AF0 :                     	;; Reset entry point
    1448/     AF0 :                     	;;
    1449/     AF0 :                     	
    1450/     AF0 : EA 00 00 50 FF      	JMPF	MON_CSEG:CSTART
    1451/     AF5 :                     
    1452/     AF5 : FF FF FF FF FF FF   	db	10h - ($ & 0fh) dup(0ffh)
              AFB : FF FF FF FF FF    
    1453/     B00 :                     ;;;
    1454/     B00 :                     ;;; RAM area
    1455/     B00 :                     ;;;
    1456/     B00 :                     
    1457/       0 :                     	SEGMENT	DATA
    1458/       0 :                     
    1459/       0 :                     	;;
    1460/       0 :                     	;; Work area
    1461/       0 :                     	;;
    1462/       0 :                     
    1463/     100 :                     	ORG	WORK_B
    1464/     100 :                     
    1465/     100 :                     INBUF:	DS	BUFLEN	; Line input buffer
    1466/     150 :                     CURSEG:	DS	2	; Current segment
    1467/     152 :                     DSADDR:	DS	2	; DUMP start address
    1468/     154 :                     DEADDR:	DS	2	; DUMP end address
    1469/     156 :                     DSTATE:	DS	1	; DUMP state
    1470/     157 :                     	ALIGN	2
    1471/     158 :                     GADDR:	DS	2	; GO address
    1472/     15A :                     SADDR:	DS	2	; SET address
    1473/     15C :                     HEXMOD:	DS	1	; HEX file mode
    1474/     15D :                     PSPEC:	DS	2	; Processor spec.
    1475/     15F :                     
    1476/     15F :                     RECTYP:	DS	1	; Record type
    1477/     160 :                     
    1478/     160 :                     	ALIGN	2
    1479/     160 :                     REG_B:	
    1480/     160 :                     REGAX:	DS	2
    1481/     162 :                     REGBX:	DS	2
    1482/     164 :                     REGCX:	DS	2
    1483/     166 :                     REGDX:	DS	2
    1484/     168 :                     REGF:	DS	2
    1485/     16A :                     REGSP:	DS	2		; Stack Pointer SP
    1486/     16C :                     REGBP:	DS	2		; Base Pointer BP
    1487/     16E :                     REGSI:	DS	2		; Source Index SI
    1488/     170 :                     REGDI:	DS	2		; Destination Index DI
    1489/     172 :                     REGIP:	DS	2		; Instruction Pointer IP
    1490/     174 :                     REGCS:	DS	2		; Code Segment CS
    1491/     176 :                     REGDS:	DS	2		; Data Segment DS
    1492/     178 :                     REGSS:	DS	2		; Stack Segment SS
    1493/     17A :                     REGES:	DS	2		; Extra Segment ES
    1494/     17C :                     REG_E:	
    1495/     17C :                     
    1496/     17C :                     ; break point
    1497/     17C :                     bflg	ds	1
    1498/     17D :                     bp_code	ds	1
    1499/     17E :                     brkcs	ds	2
    1500/     180 :                     brkip	ds	2
    1501/     182 :                     
    1502/     182 :                     ; Frag register bit image string buffer
    1503/     182 :                     F_bit:		ds	F_bitSize+1
    1504/     193 :                     
    1505/     193 :                     	END
 AS V1.42 Beta [Bld 227] - Source File unimon_8086.asm - Page 2 - 1/21/2024 17:9:57


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :                                        "i386-unknown-win32" - |
 BFLG :                         17C D |  BIOS_ENTRY :                  2500 - |
 BIOS_IP :                     2500 - |  BP_CODE :                      17D D |
 BRKCS :                        17E D |  BRKIP :                        180 D |
 BRKMSG :                       897 C |  BS :                             8 - |
 BUFLEN :                        50 - | *CASESENSITIVE :                  0 - |
 CHK_BPT :                      798 C | *COMPMODE :                       0 - |
 CONIN :                       0A65 C |  CONOUT :                      0A73 C |
 CONST :                       0A6E C | *CONSTPI :        3.141592653589793 - |
 COUT0 :                       0A75 C |  CPM86 :                          1 - |
 CPM86_CODE :                    40 - |  CPU_MSG :                      801 C |
 CR :                            0D - |  CRLF :                         617 C |
 CSTART :                         0 C |  CURSEG :                       150 D |
*DATE :                 "1/21/2024" - |  DEADDR :                       154 D |
 DEL :                           7F - |  DIVMSG :                       875 C |
 DP0 :                          12A C |  DP01 :                         13C C |
 DP1 :                          154 C |  DPB :                          1E7 C |
 DPB0 :                         1F9 C |  DPB1 :                         208 C |
 DPB2 :                         20D C |  DPB3 :                         229 C |
 DPL :                          1A0 C |  DPL0 :                         1BC C |
 DPL1 :                         1CD C |  DPL2 :                         1DD C |
 DPL3 :                         1E2 C |  DPM :                          16A C |
 DPM0 :                         17A C |  DPM1 :                         196 C |
 DSADDR :                       152 D |  DSEP0 :                        83F C |
 DSEP1 :                        842 C |  DSTATE :                       156 D |
 DUMP :                         10D C |  ERR :                          105 C |
 ERRMSG :                       837 C | *FALSE :                          0 - |
 FBITON :                       936 C |  FB_LOOP :                      528 C |
 FLGB :                         930 C |  FREE_SEG :                      40 - |
*FULLPMMU :                       1 - |  F_BIT :                        182 D |
 F_BITSIZE :                     10 - |  F_MSK_BIT :                   0FD5 - |
 G0 :                           24D C |  G0_0 :                         281 C |
 G1 :                           254 C |  G2 :                           269 C |
 GADDR :                        158 D |  GE :                           266 C |
 GETLIN :                       621 C |  GL0 :                          626 C |
 GLB :                          650 C |  GLE :                          668 C |
 GO :                           22A C |  GO_ANYWHERE :                  2AC C |
 GO_GO :                        291 C | *HAS64 :                          0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
 HEXIN :                        5EB C |  HEXMOD :                       15C D |
 HEXOUT1 :                      5DE C |  HEXOUT2 :                      5D1 C |
 HEXOUT4 :                      5CA C |  HI0 :                          5F8 C |
 HI1 :                          612 C |  HIR :                          616 C |
 HO10 :                         5E8 C |  ID_V20 :                       0A0 C |
 IHEMSG :                       81D C | *IHEXER :                       846 C |
 IM88 :                         80D C |  IMV20 :                        814 C |
 INBUF :                        100 D |  INI0 :                          5E C |
 INI1 :                          75 C |  INIVEC :                       861 C |
 INIVECE :                      875 C | *INSUPMODE :                      0 - |
 INT0 :                         755 C |  INT21VEC :                      84 - |
 INTBRK :                       72A C |  INTDIV :                       6E8 C |
 INTDMY :                       7B6 C |  INTFNC :                       6B5 C |
 INTNMI :                       714 C |  INTOVF :                       741 C |
 INTSTP :                       6FE C |  INVOKE_MSG :                   7B7 C |
 IR0 :                           2D C |  LF :                            0A - |
 LH0 :                          38C C |  LH1 :                          38E C |
 LH2 :                          39A C |  LH3 :                          3AD C |
 LHE :                          3BA C |  LHI0 :                         3BD C |
 LHI1 :                         3E2 C |  LHI2 :                         3F3 C |
 LHI3 :                         3F7 C |  LHIE :                         40B C |
 LHS0 :                         414 C |  LHS1 :                         43A C |
 LHS2 :                         44C C |  LHS3 :                         450 C |
 LHSE :                         463 C |  LHSR :                         405 C |
*LISTON :                         1 - |  LOADH :                        370 C |
 M00 :                          0E2 C |  M01 :                          0E9 C |
 M02 :                          0F0 C |  M03 :                          0F7 C |
 M05 :                          0FE C |  M06 :                          105 C |
*MACEXP :                         7 - | *MOMCPU :                      8086 - |
*MOMCPUNAME :                "8086" - |  MON_B :                          0 - |
 MON_CSEG :                   0FF50 - |  MON_DSEG :                   0FF30 - |
 MSGOE :                        5BC C |  MSGOUT :                       5AF C |
*NESTMAX :                      100 - |  NFNC1 :                        6BE C |
 NFNC2 :                        6C9 C |  NFNC3 :                        6D5 C |
 NFNC4 :                        6E7 C |  NMIMSG :                       88F C |
 NMI_SIG_OFF :                   30 - |  NOBRKP :                       7B3 C |
*OPNMSG :                       7DA C |  OVFMSG :                       8A1 C |
*PADDING :                        1 - |  PROMPT :                       81A C |
 PSPEC :                        15D D |  RD0 :                          4FC C |
 RD1 :                          514 C |  RDF1 :                         531 C |
 RDF2 :                         536 C |  RDHEX :                        685 C |
 RDSAX :                        8EA C |  RDSBP :                        91C C |
 RDSBX :                        8EE C |  RDSCS :                        902 C |
 RDSCX :                        8F3 C |  RDSDI :                        926 C |
 RDSDS :                        907 C |  RDSDX :                        8F8 C |
 RDSES :                        911 C |  RDSF :                         8FD C |
 RDSIP :                        92B C |  RDSSI :                        921 C |
 RDSSP :                        916 C |  RDSSS :                        90C C |
 RDTAB :                        8AE C |  RDUMP :                        4F9 C |
 RECTYP :                       15F D |  REG :                          46C C |
 REGAX :                        160 D |  REGBP :                        16C D |
 REGBX :                        162 D |  REGCS :                        174 D |
 REGCX :                        164 D |  REGDI :                        170 D |
 REGDS :                        176 D |  REGDX :                        166 D |
 REGES :                        17A D |  REGF :                         168 D |
 REGIP :                        172 D |  REGSI :                        16E D |
 REGSP :                        16A D |  REGSS :                        178 D |
 REG_B :                        160 D |  REG_E :                        17C D |
*RELAXED :                        0 - |  RESET_VEC :                   0AF0 - |
 RG0 :                          47D C |  RG1 :                          480 C |
 RG2 :                          492 C |  RG3 :                          4A6 C |
 RG4 :                          4CF C |  RG5 :                          4D4 C |
 RG6 :                          4F1 C |  RG7 :                          4F3 C |
 RGE :                          4F6 C |  RGR :                          4F3 C |
 RH0 :                          68C C |  RH1 :                          6A3 C |
 RHE :                          6B4 C |  RNAH :                        0A27 C |
 RNAL :                        0A2A C |  RNAX :                        0A24 C |
 RNBH :                        0A30 C |  RNBL :                        0A33 C |
 RNBP :                        0A36 C |  RNBX :                        0A2D C |
 RNCH :                        0A3C C |  RNCL :                        0A3F C |
 RNCS :                        0A42 C |  RNCX :                        0A39 C |
 RNDH :                        0A48 C |  RNDI :                        0A4E C |
 RNDL :                        0A4B C |  RNDS :                        0A51 C |
 RNDX :                        0A45 C |  RNES :                        0A54 C |
 RNF :                         0A57 C |  RNIP :                        0A59 C |
 RNSI :                        0A5C C |  RNSP :                        0A5F C |
 RNSS :                        0A62 C |  RNTAB :                        946 C |
 RNTABA :                       97C C |  RNTABB :                       994 C |
 RNTABC :                       9B2 C |  RNTABD :                       9D0 C |
*RNTABE :                       9F4 C |  RNTABI :                      0A00 C |
 RNTABS :                      0A0C C |  SADDR :                        15A D |
 SETM :                         2E6 C |  SHEMSG :                       82A C |
 SKIPSP :                       670 C |  SM0 :                          300 C |
 SM1 :                          30D C |  SM2 :                          34A C |
 SM3 :                          355 C |  SM4 :                          35C C |
 SME :                          36D C | *SRECER :                       854 C |
 SSR :                          679 C |  STACK :                        100 - |
 STPMSG :                       886 C |  STROE :                        5C9 C |
 STROUT :                       5BD C |  T0 :                           562 C |
 T1 :                           569 C | *TARGET :                    "8088" - |
 TBIT_OFF :                    0ED5 - |  TBIT_ON_ :                     100 - |
 TE :                           56F C | *TIME :                   "17:9:57" - |
 TO_GO :                        572 C |  TRACE :                        548 C |
*TRUE :                           1 - |  UPPER :                        67A C |
 UPR :                          684 C |  USARTC :                         2 - |
 USARTD :                         0 - |  VECSIZ :                       100 - |
*VERSION :                     142F - |  WORK_B :                       100 - |
 WSTART :                       0BC C |

    272 symbols
     26 unused symbols

 AS V1.42 Beta [Bld 227] - Source File unimon_8086.asm - Page 3 - 1/21/2024 17:9:57


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.18 seconds assembly time

   1507 lines source file
      3 passes
      0 errors
      0 warnings
